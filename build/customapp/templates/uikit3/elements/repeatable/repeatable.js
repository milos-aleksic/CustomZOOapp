/* Copyright (C) YOOtheme GmbH, https://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(e){var n=function(){};e.extend(n.prototype,{name:"ElementRepeatable",options:{msgDeleteElement:null,msgSortElement:null},initialize:function(t,o){this.options=e.extend({},this.options,o);var i=this,a=t.find("ul.repeatable-list"),r=a.find("li.hidden").remove(),p=a.find("li.repeatable-element").length;a.find("li.repeatable-element").each(function(){i.attachButtons(e(this))}),a.on("mousedown","span.sort",function(){a.find(".more-options.show-advanced").removeClass("show-advanced")}).on("click","span.delete",function(){e(this).closest("li.repeatable-element").fadeOut(200,function(){e(this).remove()})}).sortable({handle:"span.sort",placeholder:"uk-placeholder repeatable-element dragging",axis:"y",opacity:1,delay:100,cursorAt:{top:16},tolerance:"pointer",containment:"parent",scroll:!1,start:function(s,l){l.item.addClass("ghost"),l.placeholder.height(l.item.height()-2),l.placeholder.width(l.item.find("div.repeatable-content").width()-2)},stop:function(s,l){l.item.removeClass("ghost")}}),t.find("p.add a").on("click",function(){var s=e("<li>").addClass("repeatable-element").html(r.html().replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+p+++"]"));i.attachButtons(s),s.appendTo(a),s.find('input:not([type="radio"]), :not([type="checkbox"])').each(function(){e(this).val()&&e(this).val("")}),s.children("div.repeatable-content").effect("highlight",{},1e3)})},attachButtons:function(t){t.children().wrapAll(e("<div>").addClass("repeatable-content")),e("<span>").addClass("uk-icon sort").attr({title:this.options.msgSortElement,"uk-icon":"icon: more-vertical"}).appendTo(t),e("<span>").addClass("uk-icon delete").attr({title:this.options.msgDeleteElement,"uk-icon":"icon: trash"}).appendTo(t)}}),e.fn[n.prototype.name]=function(){var t=arguments,o=t[0]?t[0]:null;return this.each(function(){var i=e(this);if(n.prototype[o]&&i.data(n.prototype.name)&&o!="initialize")i.data(n.prototype.name)[o].apply(i.data(n.prototype.name),Array.prototype.slice.call(t,1));else if(!o||e.isPlainObject(o)){var a=new n;n.prototype.initialize&&a.initialize.apply(a,e.merge([i],t)),i.data(n.prototype.name,a)}else e.error("Method "+o+" does not exist on jQuery."+n.name)})}})(jQuery);
